<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QuickChat â€” Admin Edition</title>
<!-- FontAwesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  :root{--bg:#0b0f14;--elev:#111723;--border:#1b2435;--text:#e6eefc;--muted:#98a7c0;--brand:#4f8cff}
  body.theme-high { --bg:#05070b; --elev:#0a1120; --border:#172135; --text:#eaf2ff; --muted:#9fb1cc; --brand:#4f8cff }
  body.theme-dim { --bg:#0b0f14; --elev:#111723; --border:#1b2435; --text:#e6eefc; --muted:#98a7c0; --brand:#4f8cff }

  html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
  .app{display:flex;flex-direction:column;height:100%}
  header{display:flex;align-items:center;gap:.6rem;padding:.7rem;background:linear-gradient(180deg,var(--elev),#0e1420);border-bottom:1px solid var(--border)}
  .title{font-weight:800}
  main{flex:1;overflow:auto;padding:0.8rem}
  .card{background:#0e1420;border:1px solid var(--border);border-radius:12px;padding:.75rem}
  .hidden{display:none}
  .input{width:100%;padding:.6rem;border-radius:10px;border:1px solid var(--border);background:#0b1220;color:var(--text);margin:.4rem 0}
  .input:focus{outline:2px solid var(--brand);}
  .btn{background:var(--brand);border:none;color:#fff;padding:.6rem .8rem;border-radius:10px;cursor:pointer;transition:background 0.2s,opacity 0.2s;}
  .btn.ghost{background:transparent;border:1px solid var(--border)}
  .btn:focus{outline:2px solid #357ae8;}
  .btn:hover{opacity:0.85;background:#357ae8;}
  .list{display:flex;flex-direction:column;gap:.5rem;margin-top:.5rem}
  .item{display:flex;align-items:center;gap:.5rem;padding:.5rem;border-radius:10px;background:#0b1424;border:1px solid var(--border);transition:background 0.2s;}
  .item:hover{background:#112040;cursor:pointer;}
  .avatar{width:40px;height:40px;border-radius:50%;object-fit:cover}
  .admin-floating{position:fixed;left:12px;top:72px;z-index:9999}
  pre{white-space:pre-wrap;word-break:break-word}

  /* Fullscreen chat mode */
  .fullscreen-chat #appUI > div { display: flex; flex-direction: column; }
  .fullscreen-chat #appUI > div > div:first-child { display: none; }
  .fullscreen-chat #appUI > div > div:last-child { width: 100% !important; }

  /* Loading spinner */
  #loadingSpinner{ text-align:center; margin:24px 0;}
  #loadingSpinner > div{ border:3px solid #4f8cff; border-top:3px solid #fff; border-radius:50%; width:32px; height:32px; animation:spin 1s linear infinite;}
  @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }

  /* Toast area positioning (mobile friendly) */
  #toasts{ position:fixed; left:6%; width:88%; max-width:400px; bottom:22px; z-index:9999; transform:none; }

  /* Responsive for mobile */
  @media(max-width:700px){
    #appUI > div { flex-direction: column !important; }
    #appUI > div > div { width: 100% !important; }
    .card { margin-bottom: .9rem; }
    header .title { font-size:1.2rem; }
    #navAvatar { width:30px;height:30px;}
    #chatAvatar {margin-left:10px;}
  }
</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="title">QuickChat <span style="font-weight:400;font-size:0.93em;color:var(--muted)">Admin Edition</span></div>
    <div style="flex:1"></div>
    <div style="display:flex;align-items:center;gap:0.5rem">
      <img id="navAvatar" class="avatar" src="" alt="Profile Avatar" style="width:36px;height:36px;border:1px solid var(--border);cursor:pointer" title="Toggle Profile Menu"/>
      <button id="logoutBtn" class="btn ghost" title="Logout" aria-label="Logout"><i class="fas fa-sign-out-alt"></i></button>
    </div>
  </header>

  <div id="globalBanner" class="hidden" style="background:#0c2140;border-bottom:1px solid var(--border);padding:.5rem;text-align:center;color:#dfefff"></div>

  <main>
    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="hidden">
      <div></div>
    </div>
    <!-- AUTH CARD -->
    <section id="auth" class="card" style="max-width:720px;margin:auto">
      <h3>Sign in / Register</h3>
      <input id="loginEmail" class="input" placeholder="Email" type="email" />
      <input id="loginPass" class="input" placeholder="Password" type="password" />
      <div style="display:flex;gap:.5rem;margin-top:.5rem">
        <button id="loginBtn" class="btn" aria-label="Log in">Log in</button>
        <button id="registerBtn" class="btn ghost" aria-label="Register">Register</button>
        <button id="googleBtn" class="btn ghost" aria-label="Sign in with Google"><i class="fab fa-google"></i></button>
      </div>
      <div id="authMsg" style="color:var(--muted);margin-top:.5rem"></div>
    </section>

    <!-- APP PAGES -->
    <section id="appUI" class="hidden" style="max-width:1100px;margin:16px auto 80px">
      <div style="display:flex;gap:1rem;align-items:flex-start">
        <div style="flex:1">

          <!-- Profile and Admin Panel Container -->
          <div id="profileAdminPanel" class="card" style="margin-bottom:.8rem; display:none;">
            <strong>My Profile</strong>
            <input id="profName" class="input" placeholder="Display name" />
            <input id="profAvatarUrl" class="input" placeholder="Avatar URL (optional)" />
            <div id="avatarPreview" style="margin-top:10px"></div>
            <div style="display:flex;gap:.5rem;margin-bottom:1rem;">
              <button id="saveProfileBtn" class="btn" aria-label="Save Profile">Save</button>
              <button id="resetAvatarBtn" class="btn ghost" aria-label="Reset Avatar">Reset Avatar</button>
            </div>

            <div id="adminControls" style="display:none; border-top: 1px solid var(--border); padding-top:10px; margin-top: 8px;">
              <div style="font-weight:700; margin-bottom:8px;">Admin Panel ðŸ‘‘</div>

              <div style="display:flex;gap:6px;margin-bottom:8px">
                <input id="adminTarget" class="input" placeholder="UID or 5-digit ID" style="padding:.4rem" />
                <button id="adminLookupBtn" class="btn ghost" aria-label="Lookup"><i class="fas fa-search"></i></button>
              </div>

              <div style="display:flex;gap:6px;margin-bottom:8px">
                <button id="adminVerifyBtn" class="btn" aria-label="Verify"><i class="fas fa-check"></i> Verify</button>
                <button id="adminUnverifyBtn" class="btn ghost" aria-label="Unverify"><i class="fas fa-times"></i> Unverify</button>
              </div>

              <div style="display:flex;gap:6px;margin-bottom:8px">
                <button id="adminBanBtn" class="btn ghost" aria-label="Ban"><i class="fas fa-ban"></i> Ban</button>
                <button id="adminUnbanBtn" class="btn ghost" aria-label="Unban"><i class="fas fa-unlock"></i> Unban</button>
              </div>

              <div style="margin-bottom:8px">
                <input id="adminChatId" class="input" placeholder="Chat ID (room id)" style="margin-bottom:6px;padding:.4rem" />
                <input id="adminMsgKey" class="input" placeholder="Message Key to delete" style="padding:.4rem" />
                <div style="display:flex;gap:6px;margin-top:6px">
                  <button id="adminDelMsgBtn" class="btn secondary" aria-label="Delete Message"><i class="fas fa-trash"></i></button>
                </div>
              </div>

              <div style="margin-top:8px;border-top:1px solid var(--border);padding-top:8px;margin-bottom:8px;">
                <div style="font-weight:700;margin-bottom:6px">Global Announcement</div>
                <input id="adminAnnText" class="input" placeholder="Announcement text" style="padding:.4rem" />
                <div style="display:flex;gap:6px;margin-top:6px">
                  <button id="adminAnnSet" class="btn" aria-label="Set Announcement"><i class="fas fa-bullhorn"></i> Set</button>
                  <button id="adminAnnClear" class="btn ghost" aria-label="Clear Announcement"><i class="fas fa-eraser"></i> Clear</button>
                </div>
              </div>

              <div>
                <button id="adminRefreshUsers" class="btn ghost" aria-label="Refresh Users"><i class="fas fa-sync"></i> Refresh Users</button>
                <div id="adminUsersList" style="max-height:220px;overflow:auto;margin-top:8px"></div>
              </div>
            </div>
          </div>

          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <strong>Friends</strong>
              <div id="myShort" style="color:var(--muted)"></div>
            </div>
            <div id="friendsList" class="list" style="margin-top:.6rem;max-height:280px;overflow:auto"></div>
          </div>

          <div class="card" style="margin-top:.8rem">
            <strong>Communities</strong>
            <div id="communitiesList" class="list"></div>
          </div>
        </div>

        <div style="width:420px">
          <div class="card" id="chatCard">
            <div style="display:flex;align-items:center;gap:.6rem;position:relative">
              <button id="chatBackBtn" class="btn ghost" style="display:none;position:absolute;left:0;" aria-label="Back"><i class="fas fa-arrow-left"></i></button>
              <img id="chatAvatar" class="avatar" src="" alt="Chat Avatar" style="margin-left:30px">
              <div style="flex:1">
                <div id="chatTitle" style="font-weight:800">No chat</div>
                <div id="chatPresence" style="color:var(--muted);font-size:.85rem">â€”</div>
              </div>
              <div>
                <button id="audioCallBtn" class="btn ghost" title="Audio call (planned)" aria-label="Audio Call"><i class="fas fa-phone"></i></button>
                <button id="videoCallBtn" class="btn ghost" title="Video call (planned)" aria-label="Video Call"><i class="fas fa-video"></i></button>
              </div>
            </div>

            <div id="messages" style="margin-top:.6rem;max-height:360px;overflow:auto;background:#071022;padding:.6rem;border-radius:8px"></div>

            <div style="display:flex;gap:.5rem;margin-top:.6rem">
              <input id="msgInput" class="input" placeholder="Message..." style="flex:1" autocomplete="off" aria-label="Type your message" />
              <input id="fileInput" type="file" accept="image/*" style="display:none" />
              <button id="attachBtn" class="btn ghost" title="Attach image" aria-label="Attach Image"><i class="fas fa-paperclip"></i></button>
              <button id="sendBtn" class="btn" aria-label="Send"><i class="fas fa-paper-plane"></i></button>
            </div>
            <div id="typingIndicator" style="color:var(--muted);margin-top:.4rem;display:none">Someone is typingâ€¦</div>
          </div>
        </div>
      </div>

      <div style="height:12px"></div>
      <div class="card" id="callHistoryCard">
        <strong>Call History</strong>
        <div id="callHistory" class="list"></div>
      </div>
    </section>
  </main>
</div>

<!-- Toast area -->
<div id="toasts"></div>

<!-- Firebase + logic + UI enhancements -->
<script type="module">
/* ...==== your existing Firebase logic goes here ==== ... */
/* The same code you pasted to me for authentication, chat, admin, etc. remains unchanged except for below enhancements: */

/* ========================== INTERFACE ENHANCEMENTS ========================== */
// Avatar preview for profile editor
document.getElementById('profAvatarUrl').addEventListener('input', function(){
  const url = this.value.trim();
  document.getElementById('avatarPreview').innerHTML = url ?
    `<img src="${url}" class="avatar" style="width:48px;height:48px;border:2px solid var(--border);" alt="Avatar Preview">` : '';
});

// "Enter" sends message in chat unless Shift is held
document.getElementById('msgInput').addEventListener('keydown', function(e){
  if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); document.getElementById('sendBtn').click(); }
});

// Loading spinner example (show/hide during heavy tasks)
function showSpinner() { document.getElementById('loadingSpinner').classList.remove('hidden'); }
function hideSpinner() { document.getElementById('loadingSpinner').classList.add('hidden'); }

/* ========================== REST OF YOUR SCRIPT ========================== */
/* Copy-paste your entire script from before: authentication, chat, admin, etc. below. */

/* ========================== Firebase init, helpers, etc. ========================== */
import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js';
import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, signOut, updateProfile } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js';
import { getDatabase, ref, set, push, onValue, get, update, remove } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js';
import { getStorage, ref as sref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-storage.js';

/* ... ALL your previous JS CODE goes below ... */
</script>
</body>
</html>
